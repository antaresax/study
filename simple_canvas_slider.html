
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <link href="/application.css" media="all" rel="stylesheet" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js" type="text/javascript"></script>

 
    <td class='td-edge'></td>
  </tr></table>
</div>

<input type="range" value="100" step="1"id = "ver" min="0" max="10" oninput="changeGain(value, 'lowGain');"></input>

<div class='main'>
  <!-- Start of tutorial code ----------------------------------------------------------  -->

<div id = "canvas1">



<canvas id="canvas" width="800" height="256" ></canvas>

</div>



<canvas id="canvas" width="800" height="256" ></canvas>

<p id="controls">
  <input type="button" id="start_button" value="Start">
  &nbsp; &nbsp;
  <input type="button" id="stop_button" value="Stop">

  <input type="button"  value="Start" onclick="aa();">
  &nbsp; &nbsp;
  <input type="button"  value="Stop" onclick="bb();">
</p>


<style>
 div#canvas1 > canvas{ width:500px; height:200px; background:black; float:left; }
    #start_button, #stop_button {
        font-size: 16pt;
    }
</style>

<!-- ----------------------------------------------------- -->

<script type="text/javascript">

    // Hacks to deal with different function names in different browsers
    window.requestAnimFrame = (function(){
      return  window.requestAnimationFrame       ||
              window.webkitRequestAnimationFrame ||
              window.mozRequestAnimationFrame    ||
              function(callback, element){
                window.setTimeout(callback, 1000 / 60);
              };
    })();


    // Global Variables for Audio
    var audioContext;
    var osc;
    var gain;
 

    var analyserNode;
    var javascriptNode;

    var audioPlaying = false;
    var sampleSize = 1024;  // number of samples to collect before analyzing FFT
                            // decreasing this gives a faster sonogram, increasing it slows it down
    var amplitudeArray;         // array to hold frequency data

    // This must be hosted on the same server as this page - otherwise you get a Cross Site Scripting error


    // Global Variables for Drawing
    var column = 0;
    var canvasWidth  = 800;
    var canvasHeight = 256;
    var ctx;

    window.onload = function() {

canvas = document.getElementById('canvas');
ctx = canvas.getContext('2d');

        // the AudioContext is the primary 'container' for all your audio node objects
        try {
            audioContext = new AudioContext();
        } catch(e) {
            alert('Web Audio API is not supported in this browser');
        }

        
    };

    function setupAudioNodes() {


       gain = audioContext.createGain();
 osc = audioContext.createOscillator();
    osc.type = 'sawtooth';
    osc.frequency.value = 1;
gain.gain.value = 0.7;

    osc.connect(gain);
     gain.connect(audioContext.destination);

 osc.start(0);
  audioPlaying = true;

     
        analyserNode   = audioContext.createAnalyser();
        javascriptNode = audioContext.createScriptProcessor(sampleSize, 1, 1);

        // Create the array for the data values
        amplitudeArray = new Uint8Array(analyserNode.frequencyBinCount);

        // Now connect the nodes together
       
        gain.connect(analyserNode);
        analyserNode.connect(javascriptNode);
        javascriptNode.connect(audioContext.destination);
    }




    function aa() {
   
            column = 0;
        

            // Set up / reset the audio Analyser and Source Buffer
            setupAudioNodes();
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
            // setup the event handler that is triggered every time enough samples have been collected
            // trigger the audio analysis and draw one column in the display based on the results
            javascriptNode.onaudioprocess = function () {
                // draw one column of the spectrogram if the audio is playing
                if (audioPlaying == true) {
                    requestAnimFrame(drawTimeDomain);
                }
            }

            // Load the Audio the first time through, otherwise play it from the buffer
            // Note that the audio load is asynchronous
         
        };


  function bb() {
    
       
            osc.stop(0);
            audioPlaying = false;
        };

    // Load the sound from the URL only once and store it in global variable audioData


  
    function drawTimeDomain() {

amplitudeArray = new Uint8Array(analyserNode.frequencyBinCount);
                analyserNode.getByteTimeDomainData(amplitudeArray);

        var minValue = 9999999;
        var maxValue = 0;

        for (var i = 0; i < amplitudeArray.length; i++) {
            var value = amplitudeArray[i] / 256;
            if(value > maxValue) {
                maxValue = value;
            } else if(value < minValue) {
                minValue = value;
            }
        }

        var y_lo = canvasHeight - (canvasHeight * minValue) - 1;
        var y_hi = canvasHeight - (canvasHeight * maxValue) - 1;

        ctx.fillStyle = '#ffffff';
        ctx.fillRect(column,y_lo, 1, y_hi - y_lo);

        // loop around the canvas when we reach the end
        column += 1;
        if(column >= canvasWidth) {
            column = 0;
            ctx.clearRect(0, 0, canvasWidth, canvasHeight);
        }
    }




var knob = document.getElementById('ver');

knob.addEventListener("change",knob0,false);



function knob0(data) {

str= 0;

str= data.target.value

osc.frequency.value = str;



}


</script>


  <!-- End of tutorial code ------------------------------------------------------------  -->
</div>




</body>
</html>
